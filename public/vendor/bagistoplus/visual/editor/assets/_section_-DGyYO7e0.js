import{_ as Q}from"./trash-BHZacyVe.js";import{_ as X,A as h,a as G}from"./accordion-DbbIKiKL.js";import{_ as ee,a as te,b as ne,S as oe,c as se}from"./sortable.core.esm-Cr2DoDFZ.js";import{d as O,O as Y,u as Z,Y as j,Q as B,c as f,o as s,b as g,e as i,t as x,R as t,w as H,f as w,g as le,h as q,F as D,r as P,Z as ce,a as R,S as d,i as T,_ as ae,$ as I}from"./index-Cv1iDGG3.js";import{g as ie}from"./utils-BZao-1VW.js";import"./x-mark-C1Hxigmw.js";const re={class:""},ue=["data-disabled"],de={class:"handle flex-none py-1 px-1 rounded-md hover:bg-zinc-200 cursor-move"},me={class:"w-0 flex-1 truncate text-xs capitalize"},_e=O({__name:"Block",props:{block:null,schema:null},emits:["remove","toggle"],setup(y,{emit:C}){const p=Y(),l=Z(),c=j(),r=C,a=y,v=B(()=>{let o;for(const n of[m,S,L,M,z,A])if(o=n())break;return o?a.block.name+" - "+o:a.block.name}),m=()=>{const o=a.schema.settings.find(u=>u.type==="product");if(!o)return null;const n=p.getProduct(a.block.settings[o.id]);return n==null?void 0:n.name},S=()=>{const o=a.schema.settings.find(u=>u.type==="category");if(!o)return null;const n=p.getCategory(a.block.settings[o.id]);return n==null?void 0:n.name},L=()=>{const o=a.schema.settings.find(u=>u.type==="cms_page");if(!o)return null;const n=p.getCmsPage(a.block.settings[o.id]);return n==null?void 0:n.page_title},z=()=>a.block.settings.title,A=()=>a.block.settings.heading,M=()=>{const o=a.schema.settings.find(u=>u.type==="text");if(!o)return null;const n=a.block.settings[o.id];return n?F(n):null};function N(){l.push({name:"/[section].[block]",params:{block:a.block.id,section:c.params.section}})}function F(o){const u=new DOMParser().parseFromString(o,"text/html").body.textContent;return u==="undefined"||u==="null"?o:u}return(o,n)=>{const u=ee,e=Q,_=te,k=ne;return s(),f("div",re,[g("div",{class:"flex rounded border border-zinc-100 hover:bg-zinc-100 cursor-pointer active:ring-inset active:ring-2 active:ring-gray-700 data-[disabled=true]:text-zinc-500","data-disabled":y.block.disabled},[g("button",de,[i(u,{class:"inline w-4"})]),g("div",{onClick:N,class:"group mx-2 py-1 pr-1 text-sm flex-1 flex items-center max-w-full"},[g("div",me,x(t(v)),1),g("button",{onClick:n[0]||(n[0]=H($=>r("remove"),["stop"])),class:"flex-none invisible group-hover:visible py-[1px] px-[2px] rounded-md hover:bg-zinc-200"},[i(e,{class:"inline w-4"})]),g("button",{onClick:n[1]||(n[1]=H($=>r("toggle"),["stop"])),class:"flex-none invisible group-hover:visible py-[1px] px-[2px] rounded-md hover:bg-zinc-200 ml-1"},[y.block.disabled?(s(),w(k,{key:1,class:"inline w-4"})):(s(),w(_,{key:0,class:"inline w-4"}))])])],8,ue)])}}}),ge=O({__name:"BlocksGroup",props:{blocks:null,order:null,blocksSchema:null},emits:["reorder","toggleBlock","removeBlock"],setup(y,{emit:C}){const p=y,l=C,c=le("sortable");return q(()=>{new oe(c.value,{animation:150,ghostClass:"sortable-ghost",onEnd({newIndex:r,oldIndex:a}){const v=[...p.order],m=v.splice(a,1)[0];v.splice(r,0,m),l("reorder",v)}})}),(r,a)=>{const v=_e;return s(),f("div",{ref_key:"sortable",ref:c,class:"space-y-1"},[(s(!0),f(D,null,P(y.blocks,m=>(s(),w(v,{key:m.id,block:m,schema:y.blocksSchema.find(S=>S.type===m.type),onToggle:S=>l("toggleBlock",m.id),onRemove:S=>l("removeBlock",m.id)},null,8,["block","schema","onToggle","onRemove"]))),128))],512)}}}),pe={key:0,class:"flex flex-col h-full overflow-hidden relative w-full"},fe={class:"flex-none p-2 border-b"},be={class:"flex items-center"},ve={class:"ml-2 truncate"},ke={key:0,class:"mt-2 text-sm"},he={class:"flex-1 overflow-y-auto"},xe={key:1,class:"p-2 text-sm"},ye={key:0,class:"flex-none border-t"},Te=O({__name:"[section]",setup(y){const C=Z(),p=j(),l=Y(),c=B(()=>l.getSectionData(p.params.section)),r=B(()=>c.value?l.getSectionBySlug(c.value.type):null),a=B(()=>l.canRemoveSection(p.params.section)),v=B(()=>{var e;return ie(((e=r.value)==null?void 0:e.settings)||[])}),m=B(()=>c.value.blocks_order.map(e=>c.value.blocks[e])),S=B(()=>{var _;const e=((_=r.value)==null?void 0:_.blocks)||[];return m.value.length===0?e:e.filter(k=>{const $=m.value.filter(E=>E.type===k.type);return k.limit===void 0?!0:$.length<k.limit})}),L=B(()=>{var e;return c.value.blocks_order.length<((e=r.value)==null?void 0:e.maxBlocks)});q(()=>{l.selectSection(p.params.section)}),ce((e,_)=>{e.params.section||l.deselectSection(p.params.section)});function z(){C.back()}function A(){l.removeSection(p.params.section),z()}function M(e){return l.getThemeDataValue(`sectionsData.${c.value.id}.settings.${e}`)}function N(e,_){return l.updateThemeDataValue(`sectionsData.${c.value.id}.settings.${e}`,_)}function F(e){const _=r.value.blocks.find(k=>k.type===e);l.addBlockToSection(c.value.id,_)}function o(e){l.updateThemeDataValue(["sectionsData",c.value.id,"blocks_order"],e)}function n(e){l.toggleSectionBlock(c.value.id,e)}function u(e){l.removeSectionBlock(c.value.id,e)}return(e,_)=>{const k=X,$=ae,E=ge,J=se,K=G,U=Q;return t(r)?(s(),f("div",pe,[g("header",fe,[g("div",be,[g("button",{class:"p-1 px-2 rounded hover:bg-gray-200 focus:outline-none",onClick:z},[i(k,{class:"inline w-4"})]),g("span",ve,x(t(c).settings.heading||t(r).name),1)]),t(r).description?(s(),f("p",ke,x(t(r).description),1)):R("",!0)]),g("section",he,[i(t(h).Root,{multiple:"",defaultValue:["blocks","Settings"]},{default:d(()=>[t(r).blocks.length>0?(s(),w(t(h).Item,{key:0,value:"blocks"},{default:d(()=>[i(t(h).ItemTrigger,null,{default:d(()=>[T(x(e.$t("Blocks"))+" ",1),i(t(h).ItemIndicator,null,{default:d(()=>[i($)]),_:1})]),_:1}),i(t(h).ItemContent,null,{default:d(()=>[i(E,{class:"-mt-2 mb-2",blocks:t(m),blocksSchema:t(r).blocks,order:t(c).blocks_order,onReorder:o,onToggleBlock:n,onRemoveBlock:u},null,8,["blocks","blocksSchema","order"]),t(S).length>0?(s(),w(t(I).Root,{key:0,onSelect:_[0]||(_[0]=b=>F(b.value))},{default:d(()=>[i(t(I).Trigger,{disabled:!t(L),class:"w-full text-sm text-blue-600 disabled:text-zinc-500 rounded-lg cursor-pointer outline-0 inline-flex items-center gap-2 px-2 py-1 hover:bg-gray-200 focus:ring-1 focus:ring-gray-700"},{default:d(()=>[i(J,{class:"w-4 h-4 inline mr-1"}),T(" "+x(e.$t("Add Block")),1)]),_:1},8,["disabled"]),i(t(I).Positioner,{class:"w-[var(--reference-width)] !z-10"},{default:d(()=>[i(t(I).Content,{class:"flex flex-col outline-0 gap-1 p-1 bg-white shadow border rounded-lg data-[state=open]:animate-fade-in"},{default:d(()=>[(s(!0),f(D,null,P(t(S),b=>(s(),w(t(I).Item,{key:b.type,value:b.type,class:"outline-0 rounded cursor-pointer px-2 py-2 hover:bg-gray-200"},{default:d(()=>[T(x(b.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1})]),_:1})):R("",!0)]),_:1})]),_:1})):R("",!0),(s(!0),f(D,null,P(t(v),b=>(s(),w(t(h).Item,{value:b.name,key:b.name},{default:d(()=>[i(t(h).ItemTrigger,null,{default:d(()=>[T(x(b.name)+" ",1),i(t(h).ItemIndicator,null,{default:d(()=>[i($)]),_:1})]),_:2},1024),i(t(h).ItemContent,null,{default:d(()=>[(s(!0),f(D,null,P(b.settings,V=>(s(),w(K,{key:V.id,value:M(V.id),setting:V,onInput:W=>N(V.id,W)},null,8,["value","setting","onInput"]))),128))]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1}),t(r).settings.length>0?(s(),f(D,{key:0},[],64)):(s(),f("p",xe,x(e.$t("This section has no configuration")),1))]),t(a)?(s(),f("footer",ye,[g("button",{class:"flex items-center w-full text-left py-2 px-4 text-red-500 hover:bg-gray-100",onClick:A},[i(U,{class:"inline mr-2 w-4"}),T(" "+x(e.$t("Remove section")),1)])])):R("",!0)])):R("",!0)}}});export{Te as default};
