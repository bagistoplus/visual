var me=Object.defineProperty,ve=(i,e,t)=>e in i?me(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,g=(i,e,t)=>ve(i,typeof e!="symbol"?e+"":e,t);class be{constructor(e,t="*"){g(this,"handlers",new Map),g(this,"targetWindow"),g(this,"targetOrigin"),g(this,"fallbackHandler"),this.targetWindow=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage.bind(this))}handleMessage(e){const t=e.data;if(!t.type)return;const n=this.handlers.get(t.type);n?n.forEach(r=>r(t.payload,e)):this.fallbackHandler&&this.fallbackHandler(e.data,e)}send(e,t){const n={type:e,payload:t};this.targetWindow.postMessage(n,this.targetOrigin)}listen(e,t){return this.handlers.has(e)||this.handlers.set(e,[]),this.handlers.get(e).push(t),()=>{const n=this.handlers.get(e);if(n){const r=n.indexOf(t);r>-1&&n.splice(r,1)}}}registerFallbackHandler(e){this.fallbackHandler=e}}function pe(i="*"){if(window.parent===window)throw new Error("Not inside an iframe");return new be(window.parent,i)}class ge{constructor(){g(this,"listeners",new Map)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{this.off(e,t)}}off(e,t){const n=this.listeners.get(e);n&&(n.delete(t),n.size===0&&this.listeners.delete(e))}once(e,t){const n=r=>{t(r),this.off(e,n)};this.on(e,n)}emit(e,...t){const n=this.listeners.get(e);if(n){const r=t[0];n.forEach(s=>{try{s(r)}catch(o){console.error(`Error in event listener for '${String(e)}':`,o)}})}}removeAllListeners(e){e?this.listeners.delete(e):this.listeners.clear()}}class ke{constructor(e){g(this,"active",!0),g(this,"messenger"),g(this,"currentHoveredBlock",null),g(this,"currentSelectedBlock",null),g(this,"overlayButtonHovered",!1),g(this,"resizeObserver",null),g(this,"mutationObserver",null),this.messenger=e,this.messenger.listen("craftile.inspector.enable",()=>this.enable()),this.messenger.listen("craftile.inspector.disable",()=>this.disable()),this.messenger.listen("craftile.inspector.overlay-button-enter",this.handleOverlayButtonEnter.bind(this)),this.messenger.listen("craftile.inspector.overlay-button-leave",this.handleOverlayButtonLeave.bind(this)),this.messenger.listen("craftile.editor.select-block",this.handleEditorSelectBlock.bind(this)),this.messenger.listen("craftile.editor.deselect-block",this.handleEditorDeselectBlock.bind(this)),window.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}),this.setupGlobalEventListeners()}updateTrackedElement(e,t){this.currentHoveredBlock?.dataset.block===e&&(this.currentHoveredBlock=t,this.sendHoveredBlockPosition()),this.currentSelectedBlock?.dataset.block===e&&(this.currentSelectedBlock=t,this.sendSelectedBlockPosition(!0),this.trackSelectedBlock())}enable(){this.active=!0,document.body.classList.add("craftile-inspector-active"),this.currentSelectedBlock&&this.trackSelectedBlock()}disable(){this.active=!1,document.body.classList.remove("craftile-inspector-active"),this.currentHoveredBlock=null,this.overlayButtonHovered=!1,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}handleOverlayButtonEnter(){this.overlayButtonHovered=!0}handleOverlayButtonLeave(e){this.overlayButtonHovered=!1,this.currentHoveredBlock||this.messenger.send("craftile.preview.block-leave")}handleEditorSelectBlock(e){const t=document.querySelector(`[data-block="${e.blockId}"]`);t&&(this.currentSelectedBlock=t,this.sendSelectedBlockPosition(),this.trackSelectedBlock(),t.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}))}handleEditorDeselectBlock(){this.currentSelectedBlock=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}handleScroll(){this.active&&(this.currentSelectedBlock&&this.sendSelectedBlockPosition(),this.currentHoveredBlock&&this.sendHoveredBlockPosition())}setupGlobalEventListeners(){document.addEventListener("mouseover",this.handleGlobalHover.bind(this)),document.addEventListener("mouseout",this.handleGlobalLeave.bind(this)),document.addEventListener("click",this.handleGlobalClick.bind(this))}handleGlobalHover(e){if(!this.active)return;const t=e.target.closest("[data-block]");t&&(e.stopPropagation(),this.currentHoveredBlock=t,this.sendHoveredBlockPosition())}handleGlobalLeave(e){!this.active||!e.target.closest("[data-block]")||this.overlayButtonHovered||(this.currentHoveredBlock=null,this.messenger.send("craftile.preview.block-leave"))}handleGlobalClick(e){if(this.messenger.send("craftile.preview.click"),!this.active)return;const t=e.target.closest("[data-block]");if(!t)return;e.stopPropagation(),t.getAttribute("data-block")&&(this.currentSelectedBlock=t,this.sendSelectedBlockPosition(),this.trackSelectedBlock())}sendHoveredBlockPosition(){const e=this.computeElementPositioning(this.currentHoveredBlock);this.messenger.send("craftile.preview.block-hover",{blockRect:e.rect,parentRect:e.parentRect,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,blockId:this.currentHoveredBlock.dataset.block,parentFlexDirection:e.parentFlexDirection})}sendSelectedBlockPosition(e=!1){if(!this.currentSelectedBlock)return;const t=this.computeElementPositioning(this.currentSelectedBlock);this.messenger.send(e?"craftile.preview.update-selected-block":"craftile.preview.block-select",{blockRect:t.rect,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,blockId:this.currentSelectedBlock.dataset.block})}trackSelectedBlock(){if(!this.currentSelectedBlock)return;this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null),this.resizeObserver=new ResizeObserver(()=>{this.active&&this.currentSelectedBlock&&this.sendSelectedBlockPosition(!0)}),this.resizeObserver.observe(this.currentSelectedBlock),this.mutationObserver=new MutationObserver(()=>{this.active&&this.currentSelectedBlock&&this.sendSelectedBlockPosition(!0)}),this.mutationObserver.observe(this.currentSelectedBlock,{attributes:!0,subtree:!1});let e=this.currentSelectedBlock.parentElement;for(;e&&(this.mutationObserver.observe(e,{childList:!0,subtree:!1}),e!==document.body);)e=e.parentElement}computeElementPositioning(e){const t=e.getBoundingClientRect(),n=window.pageYOffset||document.documentElement.scrollTop,r=window.pageXOffset||document.documentElement.scrollLeft,s=this.findEldestParentBlock(e),o=s&&s!==e?s.getBoundingClientRect():void 0,l=this.getElementFlexDirection(e.parentElement);return{rect:t,parentRect:o,scrollTop:n,scrollLeft:r,parentFlexDirection:l}}findEldestParentBlock(e){let t=null,n=e.parentElement;for(;n&&n!==document.body;)n.hasAttribute("data-block")&&(t=n),n=n.parentElement;return t}getElementFlexDirection(e){if(!e)return"column";const t=window.getComputedStyle(e),n=t.display.includes("flex")?t.flexDirection:"column";return n==="row"||n==="row-reverse"?"row":"column"}}class oe extends ge{constructor(){super(),g(this,"messenger"),g(this,"inspector"),this.messenger=pe(window.origin),this.inspector=new ke(this.messenger),this.initialize()}initialize(){window.addEventListener("load",()=>{this.messenger.send("craftile.preview.ready",{}),setTimeout(()=>{this.sendPageData()},0)}),this.messenger.registerFallbackHandler(e=>{const{type:t,payload:n}=e;this.emit(t,n)})}sendPageData(){const e=document.getElementById("page-data");if(e)try{const t=JSON.parse(e.textContent||"{}");this.messenger.send("craftile.preview.page-data",{pageData:t})}catch(t){console.error("Failed to parse page data:",t)}}}var te=11;function we(i,e){var t=e.attributes,n,r,s,o,l;if(!(e.nodeType===te||i.nodeType===te)){for(var d=t.length-1;d>=0;d--)n=t[d],r=n.name,s=n.namespaceURI,o=n.value,s?(r=n.localName||r,l=i.getAttributeNS(s,r),l!==o&&(n.prefix==="xmlns"&&(r=n.name),i.setAttributeNS(s,r,o))):(l=i.getAttribute(r),l!==o&&i.setAttribute(r,o));for(var f=i.attributes,m=f.length-1;m>=0;m--)n=f[m],r=n.name,s=n.namespaceURI,s?(r=n.localName||r,e.hasAttributeNS(s,r)||i.removeAttributeNS(s,r)):e.hasAttribute(r)||i.removeAttribute(r)}}var $,Ce="http://www.w3.org/1999/xhtml",k=typeof document>"u"?void 0:document,Be=!!k&&"content"in k.createElement("template"),Ee=!!k&&k.createRange&&"createContextualFragment"in k.createRange();function ye(i){var e=k.createElement("template");return e.innerHTML=i,e.content.childNodes[0]}function Se(i){$||($=k.createRange(),$.selectNode(k.body));var e=$.createContextualFragment(i);return e.childNodes[0]}function Oe(i){var e=k.createElement("body");return e.innerHTML=i,e.childNodes[0]}function Te(i){return i=i.trim(),Be?ye(i):Ee?Se(i):Oe(i)}function U(i,e){var t=i.nodeName,n=e.nodeName,r,s;return t===n?!0:(r=t.charCodeAt(0),s=n.charCodeAt(0),r<=90&&s>=97?t===n.toUpperCase():s<=90&&r>=97?n===t.toUpperCase():!1)}function Ie(i,e){return!e||e===Ce?k.createElement(i):k.createElementNS(e,i)}function Ne(i,e){for(var t=i.firstChild;t;){var n=t.nextSibling;e.appendChild(t),t=n}return e}function j(i,e,t){i[t]!==e[t]&&(i[t]=e[t],i[t]?i.setAttribute(t,""):i.removeAttribute(t))}var ne={OPTION:function(i,e){var t=i.parentNode;if(t){var n=t.nodeName.toUpperCase();n==="OPTGROUP"&&(t=t.parentNode,n=t&&t.nodeName.toUpperCase()),n==="SELECT"&&!t.hasAttribute("multiple")&&(i.hasAttribute("selected")&&!e.selected&&(i.setAttribute("selected","selected"),i.removeAttribute("selected")),t.selectedIndex=-1)}j(i,e,"selected")},INPUT:function(i,e){j(i,e,"checked"),j(i,e,"disabled"),i.value!==e.value&&(i.value=e.value),e.hasAttribute("value")||i.removeAttribute("value")},TEXTAREA:function(i,e){var t=e.value;i.value!==t&&(i.value=t);var n=i.firstChild;if(n){var r=n.nodeValue;if(r==t||!t&&r==i.placeholder)return;n.nodeValue=t}},SELECT:function(i,e){if(!e.hasAttribute("multiple")){for(var t=-1,n=0,r=i.firstChild,s,o;r;)if(o=r.nodeName&&r.nodeName.toUpperCase(),o==="OPTGROUP")s=r,r=s.firstChild,r||(r=s.nextSibling,s=null);else{if(o==="OPTION"){if(r.hasAttribute("selected")){t=n;break}n++}r=r.nextSibling,!r&&s&&(r=s.nextSibling,s=null)}i.selectedIndex=t}}},N=1,ie=11,re=3,se=8;function S(){}function Pe(i){if(i)return i.getAttribute&&i.getAttribute("id")||i.id}function Ae(i){return function(t,n,r){if(r||(r={}),typeof n=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var s=n;n=k.createElement("html"),n.innerHTML=s}else n=Te(n);else n.nodeType===ie&&(n=n.firstElementChild);var o=r.getNodeKey||Pe,l=r.onBeforeNodeAdded||S,d=r.onNodeAdded||S,f=r.onBeforeElUpdated||S,m=r.onElUpdated||S,B=r.onBeforeNodeDiscarded||S,A=r.onNodeDiscarded||S,ae=r.onBeforeElChildrenUpdated||S,de=r.skipFromChildren||S,Y=r.addChild||function(c,a){return c.appendChild(a)},F=r.childrenOnly===!0,O=Object.create(null),H=[];function L(c){H.push(c)}function Q(c,a){if(c.nodeType===N)for(var b=c.firstChild;b;){var h=void 0;a&&(h=o(b))?L(h):(A(b),b.firstChild&&Q(b,a)),b=b.nextSibling}}function M(c,a,b){B(c)!==!1&&(a&&a.removeChild(c),A(c),Q(c,b))}function z(c){if(c.nodeType===N||c.nodeType===ie)for(var a=c.firstChild;a;){var b=o(a);b&&(O[b]=a),z(a),a=a.nextSibling}}z(t);function G(c){d(c);for(var a=c.firstChild;a;){var b=a.nextSibling,h=o(a);if(h){var u=O[h];u&&U(a,u)?(a.parentNode.replaceChild(u,a),x(u,a)):G(a)}else G(a);a=b}}function he(c,a,b){for(;a;){var h=a.nextSibling;(b=o(a))?L(b):M(a,c,!0),a=h}}function x(c,a,b){var h=o(a);if(h&&delete O[h],!b){var u=f(c,a);if(u===!1||(u instanceof HTMLElement&&(c=u,z(c)),i(c,a),m(c),ae(c,a)===!1))return}c.nodeName!=="TEXTAREA"?fe(c,a):ne.TEXTAREA(c,a)}function fe(c,a){var b=de(c,a),h=a.firstChild,u=c.firstChild,T,C,I,R,E;e:for(;h;){for(R=h.nextSibling,T=o(h);!b&&u;){if(I=u.nextSibling,h.isSameNode&&h.isSameNode(u)){h=R,u=I;continue e}C=o(u);var _=u.nodeType,y=void 0;if(_===h.nodeType&&(_===N?(T?T!==C&&((E=O[T])?I===E?y=!1:(c.insertBefore(E,u),C?L(C):M(u,c,!0),u=E,C=o(u)):y=!1):C&&(y=!1),y=y!==!1&&U(u,h),y&&x(u,h)):(_===re||_==se)&&(y=!0,u.nodeValue!==h.nodeValue&&(u.nodeValue=h.nodeValue))),y){h=R,u=I;continue e}C?L(C):M(u,c,!0),u=I}if(T&&(E=O[T])&&U(E,h))b||Y(c,E),x(E,h);else{var K=l(h);K!==!1&&(K&&(h=K),h.actualize&&(h=h.actualize(c.ownerDocument||k)),Y(c,h),G(h))}h=R,u=I}he(c,u,C);var ee=ne[c.nodeName];ee&&ee(c,a)}var p=t,D=p.nodeType,Z=n.nodeType;if(!F){if(D===N)Z===N?U(t,n)||(A(t),p=Ne(t,Ie(n.nodeName,n.namespaceURI))):p=n;else if(D===re||D===se){if(Z===D)return p.nodeValue!==n.nodeValue&&(p.nodeValue=n.nodeValue),p;p=n}}if(p===n)A(t);else{if(n.isSameNode&&n.isSameNode(p))return;if(x(p,n,F),H)for(var V=0,ue=H.length;V<ue;V++){var W=O[H[V]];W&&M(W,W.parentNode,!1)}}return!F&&p!==t&&t.parentNode&&(p.actualize&&(p=p.actualize(t.ownerDocument||k)),t.parentNode.replaceChild(p,t)),p}}var X=Ae(we),He=Object.defineProperty,Le=(i,e,t)=>e in i?He(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,P=(i,e,t)=>Le(i,typeof e!="symbol"?e+"":e,t);class J{constructor(e,t){P(this,"previewClient"),P(this,"morphdomOptions"),P(this,"elementCache",new Map),P(this,"regionCommentsCache",new Map),P(this,"childrenCommentsCache",new Map),this.previewClient=e||new oe,this.morphdomOptions=t?.morphdom||{},this.previewClient.on("updates.effects",this.handleEffects.bind(this)),this.previewClient.on("craftile.editor.updates",this.handleDirectUpdates.bind(this)),this.cacheRegionComments(),this.cacheChildrenComments()}static init(e,t){return new J(e,t)}getElementCached(e){if(this.elementCache.has(e)){const n=this.elementCache.get(e);if(n.isConnected)return n;this.elementCache.delete(e)}const t=document.querySelector(`[data-block="${e}"]`);return t&&this.elementCache.set(e,t),t}cacheRegionComments(){const e=document.createTreeWalker(document.body,NodeFilter.SHOW_COMMENT,null);let t;const n=new Map;for(;t=e.nextNode();){const r=t.textContent?.trim();if(r){if(r.startsWith("BEGIN region: ")){const s=r.substring(14);n.set(s,t)}else if(r.startsWith("END region: ")){const s=r.substring(12),o=n.get(s);o&&(this.regionCommentsCache.set(s,{begin:o,end:t}),n.delete(s))}}}}cacheChildrenComments(){const e=document.createTreeWalker(document.body,NodeFilter.SHOW_COMMENT,null);let t;const n=new Map;for(;t=e.nextNode();){const r=t.textContent?.trim();if(r){if(r.startsWith("BEGIN children: ")){const s=r.substring(16);n.set(s,t)}else if(r.startsWith("END children: ")){const s=r.substring(14),o=n.get(s);o&&(this.childrenCommentsCache.set(s,{begin:o,end:t}),n.delete(s))}}}}cacheChildrenCommentsForBlock(e){const t=this.getElementCached(e);if(!t)return;this.childrenCommentsCache.delete(e);const n=document.createTreeWalker(t,NodeFilter.SHOW_COMMENT,null);let r,s=null;for(;r=n.nextNode();){const o=r.textContent?.trim();if(o){if(o===`BEGIN children: ${e}`)s=r;else if(o===`END children: ${e}`&&s){this.childrenCommentsCache.set(e,{begin:s,end:r});break}}}}invalidateCache(e){[...e.updated,...e.removed].forEach(t=>{this.elementCache.delete(t),this.childrenCommentsCache.delete(t)})}handleEffects(e){const{effects:t,blocks:n,regions:r,changes:s}=e;t&&(this.invalidateCache(s),t.html&&this.handleHtmlEffects(t.html,{blocks:n,regions:r,changes:s}))}handleDirectUpdates(e){const{changes:t}=e;t.moved&&this.handleMoves(e),t.updated.length>0&&this.handleDisabledBlocks(e),t.removed.length>0&&this.handleRemoves(e)}handleMoves(e){const{blocks:t,changes:n}=e;for(const[r,s]of Object.entries(e.changes.moved)){if(s?.toParent&&n.updated?.includes(s?.toParent))continue;if(!this.isValidMoveInstruction(s)){console.warn(`Invalid move instruction for block ${r}:`,s);continue}const o=t[r];this.moveBlockUsingDOM(o,s)}}handleDisabledBlocks(e){const{blocks:t,changes:n}=e;for(const r of n.updated){const s=t[r];if(!s)continue;const l=!!this.getElementCached(r);s.disabled&&l?this.removeBlock(s.id):s.disabled}}handleRemoves(e){const{changes:t}=e;for(const n of t.removed)this.removeBlock(n)}handleHtmlEffects(e,t){const{blocks:n,regions:r}=t;for(const[s,o]of Object.entries(e)){if(!o)continue;const l=n[s];if(!l){console.warn(`Block data not found for ${s}`);continue}if(l.disabled){console.debug(`Skipping disabled block ${s}`);continue}if(!!this.getElementCached(s))this.updateBlockHtml(l,o);else{const m=this.calculatePosition(l,r,n);this.insertBlock(l,o,m)}}}isValidMoveInstruction(e){const t=!!(e.toParent||e.toRegion),n=e.toIndex===void 0||e.toIndex>=0;return t&&n}removeBlock(e){const t=this.getElementCached(e);t?(this.previewClient.emit("block.remove.before",{blockId:e,element:t}),t.remove(),this.elementCache.delete(e),this.previewClient.emit("block.remove.after",{blockId:e,element:t})):console.warn(`Block ${e} not found for removal`)}moveBlockUsingDOM(e,t){const n=this.getElementCached(e.id),{toParent:r,toRegion:s,toIndex:o}=t;if(!n){console.warn(`Block element ${e.id} not found for move operation`);return}if(this.previewClient.emit("block.move.before",{blockId:e.id,blockType:e.type,block:e,element:n,toParent:r,toRegion:s,toIndex:o}),r){const l=this.getElementCached(r);if(!l){console.error(`Parent element ${r} not found for move operation`);return}this.insertElementInContainer(n,l,e.id,o)}else if(s){const l=this.findRegionInsertionPoint(s,o,void 0,void 0,e.id);if(!l){console.error(`Failed to find insertion point for region: ${s}`);return}l.parent.insertBefore(n,l.before)}this.previewClient.emit("block.move.after",{blockId:e.id,blockType:e.type,block:e,element:n,toParent:r,toRegion:s,toIndex:o})}insertElementInContainer(e,t,n,r){const s=t.getAttribute("data-block"),o=s?this.childrenCommentsCache.get(s):null;if(o){const l=this.findPositionBetweenComments(o.begin,o.end,r,n);l.parent.insertBefore(e,l.before)}else{const d=Array.from(t.children).filter(m=>m.getAttribute("data-block")!==n),f=r!==void 0&&r<d.length?d[r]:null;t.insertBefore(e,f)}}insertBlock(e,t,n){if(this.getElementCached(e.id))return;this.previewClient.emit("block.insert.before",{blockId:e.id,blockType:e.type,block:e,html:t,positionInfo:n});const r=this.parseHtmlElement(t,e.id);if(!r)return;const{parentId:s,regionName:o,position:l,afterId:d,beforeId:f}=n;if(s){const m=this.getElementCached(s);if(!m){console.error(`Parent element ${s} not found for block ${e.id}`);return}this.insertElementByPosition(r,m,l,d,f)}else if(o){const m=this.findRegionInsertionPoint(o,l,d,f);if(!m){console.error(`Failed to find insertion point for region: ${o}`);return}m.parent.insertBefore(r,m.before)}else console.warn(`No parent or region specified for block ${e.id}, inserting into body`),document.body.appendChild(r);this.elementCache.set(e.id,r),this.cacheChildrenCommentsForBlock(e.id),r.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),this.previewClient.emit("block.insert.after",{blockId:e.id,blockType:e.type,block:e,html:t,positionInfo:n})}updateBlockHtml(e,t){if(!t){console.warn(`No HTML provided for block ${e.id}`);return}const n=this.getElementCached(e.id);if(!n){console.warn(`Block element ${e.id} not found for HTML update`);return}this.previewClient.emit("block.update.before",{blockId:e.id,blockType:e.type,block:e,element:n,html:t}),X(n,t,this.morphdomOptions),this.elementCache.delete(e.id);const r=this.getElementCached(e.id);if(!r){console.error(`Block element ${e.id} not found after morphdom update`);return}r!==n&&this.previewClient.inspector.updateTrackedElement(e.id,r),this.cacheChildrenCommentsForBlock(e.id),this.previewClient.emit("block.update.after",{blockId:e.id,blockType:e.type,block:e,element:r,html:t})}insertElementByPosition(e,t,n,r,s){const o=t.getAttribute("data-block"),l=o?this.childrenCommentsCache.get(o):null;if(l){let d=null;if(s)d=this.getElementCached(s);else if(r){const f=this.getElementCached(r);f&&f.nextSibling&&(d=f.nextSibling)}else if(typeof n=="number"){const f=this.findPositionBetweenComments(l.begin,l.end,n);l.begin.parentNode.insertBefore(e,f.before);return}d||(d=l.end),l.begin.parentNode.insertBefore(e,d)}else{let d=null;if(s)d=this.getElementCached(s);else if(r){const f=this.getElementCached(r);f&&(d=f.nextElementSibling)}else typeof n=="number"&&(d=Array.from(t.children)[n]||null);t.insertBefore(e,d)}}findRegionInsertionPoint(e,t,n,r,s){const o=this.regionCommentsCache.get(e);if(!o)return console.error(`Region comments not found for region: ${e}`),null;const{begin:l,end:d}=o;let f=null;if(r){const m=this.getElementCached(r);m&&(f=m)}else if(n){const m=this.getElementCached(n);m&&m.nextSibling&&(f=m.nextSibling)}else typeof t=="number"&&(f=this.findPositionInRegion(l,d,t,s));return f||(f=d),{parent:l.parentNode,before:f}}findPositionInRegion(e,t,n,r){const s=[];let o=e.nextSibling;for(;o&&o!==t;){if(o.nodeType===Node.ELEMENT_NODE&&o.hasAttribute("data-block")){const l=o.getAttribute("data-block");(!r||l!==r)&&s.push(o)}o=o.nextSibling}return n<s.length?s[n]:null}findPositionBetweenComments(e,t,n,r){let s=null;if(typeof n=="number"){const o=[];let l=e.nextSibling;for(;l&&l!==t;){if(l.nodeType===Node.ELEMENT_NODE&&l.hasAttribute("data-block")){const d=l.getAttribute("data-block");(!r||d!==r)&&o.push(l)}l=l.nextSibling}s=n<o.length?o[n]:null}return s||(s=t),{parent:e.parentNode,before:s}}calculatePosition(e,t,n){if(e.parentId){const r=n[e.parentId];r||console.warn(`Block data not found for block ${e.id}`);const s=r.children.indexOf(e.id);if(s===-1)return console.warn(`Block ${e.id} not found in parent ${e.parentId} children`),{parentId:e.parentId};const{afterId:o,beforeId:l}=this.findAdjacentSiblings(r.children,s,n);return{parentId:e.parentId,position:s,afterId:o,beforeId:l}}else{for(const r of t){const s=r.blocks.indexOf(e.id);if(s!==-1){const{afterId:o,beforeId:l}=this.findAdjacentSiblings(r.blocks,s,n);return{regionName:r.name,position:s,afterId:o,beforeId:l}}}return{}}}findAdjacentSiblings(e,t,n){let r,s;for(let o=t-1;o>=0;o--){const l=n[e[o]];if(l&&!l.disabled){r=e[o];break}}for(let o=t+1;o<e.length;o++){const l=n[e[o]];if(l&&!l.disabled){s=e[o];break}}return{afterId:r,beforeId:s}}parseHtmlElement(e,t){if(!e.trim())return console.error(`Empty HTML provided for block ${t}`),null;const n=document.createElement("div");n.innerHTML=e;const r=n.firstElementChild;return r||(console.error(`Invalid HTML for block ${t}: no element found`),null)}}const w=new oe;let q=!1;window.addEventListener("error",i=>{q&&i.message==="Uncaught Could not find Livewire component in DOM tree"&&i.preventDefault()});function le(){return function(e,t){if(e instanceof HTMLElement&&e.hasAttribute("wire:id")&&t.hasAttribute("wire:id")){const n=e.__livewire;if(!n)return!0;const r=t.getAttribute("wire:snapshot"),s=JSON.parse(t.getAttribute("wire:effects"));return s.html=t.outerHTML,n.mergeNewSnapshot(r,s),q=!0,n.processEffects(s),setTimeout(()=>{q=!1}),!1}return e._x_dataStack&&typeof window.Alpine?.morph=="function"?(window.Alpine.morph(e,t,{updating(n,r,s){if(n instanceof HTMLElement&&r instanceof HTMLElement&&n.hasAttribute("wire:id"))return s()}}),!1):!0}}J.init(w,{morphdom:{onBeforeElUpdated:le()}});w.on("page.refresh",i=>{const t=new DOMParser().parseFromString(i.html,"text/html");X(document.head,t.head,{childrenOnly:!0}),X(document.body,t.body,{childrenOnly:!0,onBeforeElUpdated:le()})});function ce(i){const{block:e,key:t,value:n}=i,s=`data-live-update-${[e.id,t].filter(Boolean).join(".")}`,o=`[${CSS.escape(s)}]`,l=document.querySelectorAll(o);if(l.length)for(const d of l){const f=d.getAttribute(s),[m,B]=f?.split(/:(.+)/)??["text",void 0];switch(m){case"text":d.textContent=n;break;case"html":d.innerHTML=n;break;case"outerHTML":d.outerHTML=n;break;case"attr":if(n)d.setAttribute(B,n);else{if(d.tagName.toLowerCase()==="img"&&B==="src")return!1;d.removeAttribute(B)}break;case"style":n?d.style.setProperty(B,n):d.style.removeProperty(B);break;case"toggleClass":d.classList.toggle(B);break;default:console.warn(`Unknown live update type: ${m}`)}}}w.on("block.property.updated",ce);class Me{on(e,t){const n=(r=>{t(r.detail)});return document.addEventListener(e,n),()=>{document.removeEventListener(e,n)}}off(e,t){document.removeEventListener(e,t)}emit(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))}handleLiveUpdate(e,t,n){ce({block:{id:e},key:t,value:n})}reload(){window.location.reload()}}const v=new Me;w.on("block.property.updated",i=>{v.emit("visual:block:setting:updated",i),i.block&&!i.block.parentId&&v.emit("visual:section:setting:updated",i)});w.on("block.insert.before",i=>{v.emit("visual:block:adding",i),i.block&&!i.block.parentId&&v.emit("visual:section:adding",{...i,sectionId:i.blockId,section:i.block})});w.on("block.insert.after",i=>{v.emit("visual:block:added",i),v.emit("visual:block:load",i),i.block&&!i.block.parentId&&(v.emit("visual:section:added",{...i,sectionId:i.blockId,section:i.block}),v.emit("visual:section:load",{...i,sectionId:i.blockId,section:i.block}))});w.on("block.remove.before",i=>{v.emit("visual:block:removing",i),i.block&&!i.block.parentId&&v.emit("visual:section:removing",{...i,sectionId:i.blockId,section:i.block})});w.on("block.remove.after",i=>{v.emit("visual:block:removed",i),v.emit("visual:block:unload",i),i.block&&!i.block.parentId&&(v.emit("visual:section:removed",{...i,sectionId:i.blockId,section:i.block}),v.emit("visual:section:unload",{...i,sectionId:i.blockId,section:i.block}))});w.on("block.move.before",i=>{v.emit("visual:block:moving",i),i.block&&!i.block.parentId&&v.emit("visual:section:moving",{...i,sectionId:i.blockId,section:i.block})});w.on("block.move.after",i=>{v.emit("visual:block:moved",i),i.block&&!i.block.parentId&&v.emit("visual:section:moved",{...i,sectionId:i.blockId,section:i.block})});w.on("block.update.before",i=>{v.emit("visual:block:updating",i),i.block&&!i.block.parentId&&v.emit("visual:section:updating",{...i,sectionId:i.blockId,section:i.block})});w.on("block.update.after",i=>{v.emit("visual:block:updated",i),v.emit("visual:block:load",i),i.block&&!i.block.parentId&&(v.emit("visual:section:updated",{...i,sectionId:i.blockId,section:i.block}),v.emit("visual:section:load",{...i,sectionId:i.blockId,section:i.block}))});window.Visual=v;
